<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>TacoTruck – Admin</title>
  <style>
    body{margin:0;padding:24px;font:14px system-ui,Segoe UI,Roboto,Inter,Arial;background:#f8fafc;color:#0f172a}
    h1{margin:0 0 12px}
    .row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:16px}
    button{padding:10px 14px;border:0;border-radius:8px;background:#0ea5e9;color:#fff;font-weight:600;cursor:pointer}
    button.ghost{background:#e2e8f0;color:#0f172a}
    table{width:100%;border-collapse:collapse;background:#fff;border:1px solid #e2e8f0;border-radius:8px;overflow:hidden}
    th,td{padding:8px 10px;border-bottom:1px solid #eef2f7;text-align:left;font-size:13px}
    th{background:#f1f5f9}
    .pill{background:#e2e8f0;border-radius:999px;padding:4px 10px;margin-left:6px}
    pre{white-space:pre-wrap;background:#fff;border:1px solid #e2e8f0;border-radius:8px;padding:12px;max-height:40vh;overflow:auto}
  </style>
</head>
<body>
  <h1>Admin <span id="session" class="pill"></span></h1>

  <div class="row">
    <button id="download">Download CSV</button>
    <button id="reset" class="ghost">Reset logs</button>
    <button id="refresh" class="ghost">Refresh view</button>
  </div>

  <h3>Summary</h3>
  <table id="summary"><tbody></tbody></table>

  <h3>Last 10 events</h3>
  <table id="events">
    <thead><tr><th>ts</th><th>type</th><th>disc</th><th>detail</th></tr></thead>
    <tbody></tbody>
  </table>

  <h3>Raw (truncated)</h3>
  <pre id="raw"></pre>

  <script src="tt-logger.js"></script>
  <script>
    function getLogs(){ try { return JSON.parse(localStorage.getItem('tt_logs')||'{}'); } catch { return {}; } }
    function getMeta(){ try { return JSON.parse(localStorage.getItem('tt_meta')||'{}'); } catch { return {}; } }
    function fmt(x){ return typeof x==='string' ? x : JSON.stringify(x); }

    function render(){
      const s = getLogs();
      const m = getMeta();
      document.getElementById('session').textContent = s.session_id || '(none)';

      const sum = document.querySelector('#summary tbody');
      sum.innerHTML = '';
      [
        ['Session ID', s.session_id || '—'],
        ['Started at', s.started_at || '—'],
        ['Events', (s.events||[]).length],
        ['Disclaimer', m.disc || '(unknown)'],
      ].forEach(([k,v])=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `<th>${k}</th><td>${fmt(v)}</td>`;
        sum.appendChild(tr);
      });

      const evBody = document.querySelector('#events tbody');
      evBody.innerHTML = '';
      (s.events||[]).slice(-10).reverse().forEach(e=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `<td>${e.ts}</td><td>${e.type}</td><td>${e.disc??''}</td><td>${fmt(e).slice(0,160)}</td>`;
        evBody.appendChild(tr);
      });

      const raw = JSON.stringify(s);
      document.getElementById('raw').textContent = raw.length>5000 ? raw.slice(0,5000)+' …(truncated)' : raw;
    }

    document.getElementById('download').onclick = () => TTLOG.exportCSV();
    document.getElementById('reset').onclick = () => { localStorage.removeItem('tt_logs'); render(); };
    document.getElementById('refresh').onclick = render;

    render();
  </script>
</body>
</html>
