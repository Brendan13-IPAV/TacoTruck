<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Australian IP ‚Äì Chatbot Prototype</title>
  <style>
    :root {
      --bg: linear-gradient(135deg, #f8fafc 0%, #fff7ed 100%);
      --border: rgba(2,6,23,0.08);
      --ink: #0f172a;
      --muted: #475569;
      --accentA: #d97706; /* amber-600 */
      --accentB: #c2410c; /* orange-700 */
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; min-height: 100vh; background: var(--bg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial;
      color: var(--ink); padding: 24px;
    }
    .wrap { max-width: 800px; margin: 0 auto; }
    .logo {
      width: 56px; height: 56px; border-radius: 16px;
      background: linear-gradient(135deg, var(--accentA), var(--accentB));
      display: grid; place-items: center; color: #fff; font-weight: 700;
      margin: 0 auto 12px;
    }
    h1 { margin: 0 0 6px; font-size: 32px; letter-spacing: -0.2px; }
    .sub { color: var(--muted); margin: 0 0 16px; }

    .card {
      background: #fff; border: 1px solid var(--border);
      border-radius: 16px; box-shadow: 0 10px 30px rgba(2,6,23,0.05);
      overflow: hidden;
    }
    .messages {
      height: 480px; overflow-y: auto; padding: 16px;
      background: linear-gradient(180deg,#fff 0%,rgba(248,250,252,0.6) 100%);
    }
    .row { display: flex; margin-bottom: 10px; }
    .row.user { justify-content: flex-end; }
    .bubble {
      max-width: 85%; padding: 10px 14px; border-radius: 12px;
      font-size: 14px; line-height: 1.6; white-space: pre-wrap;
      border: 1px solid var(--border); box-shadow: 0 1px 2px rgba(2,6,23,0.04);
      background: #fff; color: var(--ink);
    }
    .row.user .bubble {
      border: none; box-shadow: none; color: #fff;
      background: linear-gradient(135deg, var(--accentA), var(--accentB));
    }
    .footer { border-top: 1px solid var(--border); padding: 12px; background: #fff; }
    .controls { display: flex; gap: 8px; }
    textarea {
      flex: 1; resize: none; border: 1px solid #cbd5e1; border-radius: 10px;
      padding: 10px 12px; outline: none; color: var(--ink);
    }
    button {
      padding: 10px 14px; border-radius: 10px; border: none; font-weight: 600; cursor: pointer;
    }
    .send {
      background: linear-gradient(135deg, var(--accentA), var(--accentB)); color: #fff;
    }
    .clear { background: #f1f5f9; color: #334155; }
    .hint { margin-top: 6px; font-size: 12px; text-align: center; color: #64748b; }
    .fineprint { margin-top: 14px; text-align: center; font-size: 12px; color: #475569; }
    .spinner {
      width: 16px; height: 16px; border: 2px solid #fb923c; border-top-color: transparent;
      border-radius: 50%; animation: spin .9s linear infinite; margin-right: 8px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="logo" aria-hidden="true">üí¨</div>
    <h1>Australian IP question tester</h1>
    <p class="sub">General information about Australian IP law (prototype)</p>

    <div class="card" role="region" aria-label="Chat window">
      <div id="messages" class="messages">
        <!-- Initial assistant message -->
      </div>

      <div class="footer">
        <div class="controls">
          <textarea id="input" rows="2" placeholder="Ask about Australian patents, trade marks, copyright‚Ä¶"></textarea>
          <div style="display:flex; flex-direction:column; gap:8px;">
            <button id="send" class="send" aria-label="Send">Send</button>
            <button id="clear" class="clear" aria-label="Clear conversation">Clear</button>
          </div>
        </div>
        <div class="hint">Enter = send ¬∑ Shift+Enter = new line</div>
      </div>
    </div>

    <p class="fineprint">Prototype ‚Äî general information only, not legal advice.</p>
  </div>

  <script>
    // --- Minimal state ---
    const messagesEl = document.getElementById('messages');
    const inputEl = document.getElementById('input');
    const sendBtn = document.getElementById('send');
    const clearBtn = document.getElementById('clear');

    /** Render a message bubble */
    function addMessage(role, content) {
      const row = document.createElement('div');
      row.className = 'row ' + (role === 'user' ? 'user' : 'assistant');

      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.textContent = content;

      row.appendChild(bubble);
      messagesEl.appendChild(row);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    /** Initial greeting */
    function resetConversation() {
      messagesEl.innerHTML = '';
      addMessage(
        'assistant',
        "Hello! I'm here to help you test questions about Australian intellectual property law.\n\n" +
        "I provide general information only ‚Äî not legal advice. For advice about your situation, please consult a qualified legal professional.\n\n" +
        "What would you like to know?"
      );
      inputEl.value = '';
      inputEl.focus();
    }

    /** Demo reply (no API key needed). Replace this later with a real fetch. */
    async function getReplyDemo(userText) {
      // Simulate thinking
      await new Promise(r => setTimeout(r, 500));
      return (
        "Demo mode reply.\n\n" +
        "You asked: ‚Äú" + userText + "‚Äù.\n\n" +
        "When wired to OpenAI, this will return general information about Australian IP law only (no specific legal advice)."
      );
    }

    /** Optional: placeholder for future real call (server-side recommended)
    async function getReplyReal(history) {
      const res = await fetch('/api/openai-chat', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ history })
      });
      const data = await res.json();
      return data.reply || 'Sorry, no response.';
    } */

    /** Send flow */
    async function send() {
      const text = inputEl.value.trim();
      if (!text) return;

      addMessage('user', text);
      inputEl.value = '';
      inputEl.focus();

      // Show spinner bubble
      const thinking = document.createElement('div');
      thinking.className = 'row assistant';
      thinking.innerHTML = '<div class="bubble" style="display:flex;align-items:center;"><span class="spinner"></span>Thinking‚Ä¶</div>';
      messagesEl.appendChild(thinking);
      messagesEl.scrollTop = messagesEl.scrollHeight;

      try {
        // For now, use demo. Swap to getReplyReal([...history]) later.
        const reply = await getReplyDemo(text);
        thinking.remove();
        addMessage('assistant', reply);
      } catch (e) {
        thinking.remove();
        addMessage('assistant', 'Sorry, something went wrong. Please try again.');
      }
    }

    // Events
    sendBtn.addEventListener('click', send);
    clearBtn.addEventListener('click', resetConversation);
    inputEl.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault(); send();
      }
    });

    // Boot
    resetConversation();
  </script>
</body>
</html>
