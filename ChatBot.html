<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TacoTruck â€“ ChatBot Prototype</title>
  <style>
    :root {
      --bg: linear-gradient(135deg, #f8fafc 0%, #fff7ed 100%);
      --border: rgba(2,6,23,0.08);
      --ink: #0f172a;
      --muted: #475569;
      --accentA: #d97706;
      --accentB: #c2410c;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; min-height: 100vh; background: var(--bg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial;
      color: var(--ink); padding: 24px;
    }
    .wrap { max-width: 800px; margin: 0 auto; }
    .logo {
      width: 56px; height: 56px; border-radius: 16px;
      background: linear-gradient(135deg, var(--accentA), var(--accentB));
      display: grid; place-items: center; color: #fff; font-weight: 700;
      margin: 0 auto 12px;
    }
    h1 { margin: 0 0 6px; font-size: 32px; letter-spacing: -0.2px; }
    .sub { color: var(--muted); margin: 0 0 16px; }

    .card {
      background: #fff; border: 1px solid var(--border);
      border-radius: 16px; box-shadow: 0 10px 30px rgba(2,6,23,0.05);
      overflow: hidden;
    }
    .messages {
      height: 480px; overflow-y: auto; padding: 16px;
      background: linear-gradient(180deg,#fff 0%,rgba(248,250,252,0.6) 100%);
    }
    .row { display: flex; margin-bottom: 10px; }
    .row.user { justify-content: flex-end; }
    .bubble {
      max-width: 85%; padding: 10px 14px; border-radius: 12px;
      font-size: 14px; line-height: 1.6; white-space: pre-wrap;
      border: 1px solid var(--border); box-shadow: 0 1px 2px rgba(2,6,23,0.04);
      background: #fff; color: var(--ink);
    }
    .row.user .bubble {
      border: none; box-shadow: none; color: #fff;
      background: linear-gradient(135deg, var(--accentA), var(--accentB));
    }
    .footer { border-top: 1px solid var(--border); padding: 12px; background: #fff; }
    .controls { display: flex; gap: 8px; }
    textarea {
      flex: 1; resize: none; border: 1px solid #cbd5e1; border-radius: 10px;
      padding: 10px 12px; outline: none; color: var(--ink);
    }
    button {
      padding: 10px 14px; border-radius: 10px; border: none; font-weight: 600; cursor: pointer;
    }
    .send {
      background: linear-gradient(135deg, var(--accentA), var(--accentB)); color: #fff;
    }
    .clear { background: #f1f5f9; color: #334155; }
    .hint { margin-top: 6px; font-size: 12px; text-align: center; color: #64748b; }
    .fineprint { margin-top: 14px; text-align: center; font-size: 12px; color: #475569; }
    .spinner {
      width: 16px; height: 16px; border: 2px solid #fb923c; border-top-color: transparent;
      border-radius: 50%; animation: spin .9s linear infinite; margin-right: 8px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="logo" aria-hidden="true">ðŸŒ®</div>
    <h1>TacoTruck ChatBot</h1>
    <p class="sub">Australian IP question tester (prototype)</p>

    <div class="card" role="region" aria-label="Chat window">
      <div id="messages" class="messages"></div>

      <div class="footer">
        <div class="controls">
          <textarea id="input" rows="2" placeholder="Ask about Australian patents, trade marks, copyrightâ€¦"></textarea>
          <div style="display:flex; flex-direction:column; gap:8px;">
            <button id="send" class="send">Send</button>
            <button id="clear" class="clear">Clear</button>
          </div>
        </div>
        <div class="hint">Enter = send Â· Shift+Enter = new line</div>
      </div>
    </div>

    <p class="fineprint">Prototype only â€” provides general information, not legal advice.</p>
  </div>

 <script>
  async function getReplyDemo(userText) {
    // replaced with live outline call:
    const res = await fetch('https://<your-vercel-domain>/api/intent-outline', {
      method: 'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({ user_input: userText })
    });
    const data = await res.json();
    return data.outline || 'No outline.';
  }
</script>
  <!-- Logger (kept at root; adjust path if needed) -->
<script src="tt-logger.js"></script>

<script>
  // --- Minimal chat wiring + telemetry ---
  const messagesEl = document.getElementById('messages');
  const inputEl = document.getElementById('input');
  const sendBtn = document.getElementById('send');
  const clearBtn = document.getElementById('clear');

  function addMessage(role, content) {
    const row = document.createElement('div');
    row.className = 'row ' + (role === 'user' ? 'user' : 'assistant');
    const bubble = document.createElement('div');
    bubble.className = 'bubble';
    bubble.textContent = content;
    row.appendChild(bubble);
    messagesEl.appendChild(row);
    messagesEl.scrollTop = messagesEl.scrollHeight;
  }

  function resetConversation() {
    messagesEl.innerHTML = '';
    addMessage(
      'assistant',
      "Hello! I'm here to help you test questions about Australian intellectual property law.\n\n" +
      "I provide general information only â€” not legal advice. For advice about your situation, please consult a qualified legal professional.\n\n" +
      "What would you like to know?"
    );
    inputEl.value = '';
    inputEl.focus();
  }

  async function send() {
    const text = (inputEl.value || '').trim();
    if (!text) return;

    addMessage('user', text);
    TTLOG && TTLOG.push('chat_user_turn', { text_len: text.length });

    inputEl.value = '';
    inputEl.focus();

    // spinner bubble
    const thinking = document.createElement('div');
    thinking.className = 'row assistant';
    thinking.innerHTML =
      '<div class="bubble" style="display:flex;align-items:center;">' +
      '<span class="spinner"></span>Thinkingâ€¦</div>';
    messagesEl.appendChild(thinking);
    messagesEl.scrollTop = messagesEl.scrollHeight;

    const t0 = performance.now();
    try {
      const reply = await getReplyDemo(text); // your existing function above
      thinking.remove();
      addMessage('assistant', reply);
      TTLOG && TTLOG.push('chat_bot_turn', { rt_ms: Math.round(performance.now() - t0) });
    } catch (e) {
      thinking.remove();
      addMessage('assistant', 'Error: could not process your message.');
      TTLOG && TTLOG.push('chat_error', { message: String(e) });
    }
  }

  // hook up UI
  sendBtn.addEventListener('click', send);
  clearBtn.addEventListener('click', () => {
    resetConversation();
    TTLOG && TTLOG.push('chat_cleared');
  });
  inputEl.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      send();
    }
  });

  // telemetry bookends
  TTLOG && TTLOG.push('chat_start');
  window.addEventListener('beforeunload', () => TTLOG && TTLOG.push('chat_end'));

  // boot
  resetConversation();
</script>

</body>
</html>


